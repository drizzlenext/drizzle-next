import { eq, asc, desc, SQL } from "drizzle-orm";
import { db } from "@/db/db";
import { Select{{tableObj.singularPascalCase}}, {{tableObj.pluralCamelCase}} } from "@/db/schema/{{tableObj.pluralKebabCase}}";

export type {{tableObj.singularPascalCase}}Obj = Awaited<
  ReturnType<typeof get{{tableObj.singularPascalCase}}ById>
>;

export async function get{{tableObj.singularPascalCase}}ById(id: string) {
  return await db.query.{{tableObj.pluralCamelCase}}.findFirst({
    where: eq({{tableObj.pluralCamelCase}}.id, id),
    with: undefined,
  });
}

export type {{tableObj.singularPascalCase}}List = Awaited<
  ReturnType<typeof get{{tableObj.singularPascalCase}}List>
>;

export async function get{{tableObj.singularPascalCase}}List({
  filters,
  limit,
  offset,
  sortBy,
  sortOrder,
}: {
  filters?: SQL;
  limit?: number;
  offset?: number;
  sortBy?: string;
  sortOrder?: string;
}) {
  let orderBy;
  if (sortBy && sortBy in {{tableObj.pluralCamelCase}}) {
    switch (sortOrder) {
      case "asc":
        orderBy = asc({{tableObj.pluralCamelCase}}[sortBy as keyof Select{{tableObj.singularPascalCase}}]);
        break;
      case "desc":
        orderBy = desc({{tableObj.pluralCamelCase}}[sortBy as keyof Select{{tableObj.singularPascalCase}}]);
        break;
    }
  }

  return await db.query.{{tableObj.pluralCamelCase}}.findMany({
    where: filters,
    orderBy: orderBy,
    limit: limit,
    offset: offset,
    with: undefined
  });
}
